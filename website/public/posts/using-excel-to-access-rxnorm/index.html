<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Using Excel to access RxNorm - eddie_cosma</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Background Let&rsquo;s say you work in an institutional pharmacy that performs a physical inventory every December. This year, you discover there&rsquo;s a large discrepancy between the value of your current medication stock compared to the value of last year&rsquo;s stock. Apparently, some of the data on the handheld computers you use to perform inventory became corrupted before everything could be compiled into one large Excel file. Now you&rsquo;re missing a few hundred line items, the end of the year is coming up, and Accounting is breathing down your neck."><meta property="og:image" content><meta property="og:title" content="Using Excel to access RxNorm"><meta property="og:description" content="Background Let&rsquo;s say you work in an institutional pharmacy that performs a physical inventory every December. This year, you discover there&rsquo;s a large discrepancy between the value of your current medication stock compared to the value of last year&rsquo;s stock. Apparently, some of the data on the handheld computers you use to perform inventory became corrupted before everything could be compiled into one large Excel file. Now you&rsquo;re missing a few hundred line items, the end of the year is coming up, and Accounting is breathing down your neck."><meta property="og:type" content="article"><meta property="og:url" content="https://eddiecosma.com/posts/using-excel-to-access-rxnorm/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-01-08T00:00:00+00:00"><meta property="article:modified_time" content="2017-01-08T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using Excel to access RxNorm"><meta name=twitter:description content="Background Let&rsquo;s say you work in an institutional pharmacy that performs a physical inventory every December. This year, you discover there&rsquo;s a large discrepancy between the value of your current medication stock compared to the value of last year&rsquo;s stock. Apparently, some of the data on the handheld computers you use to perform inventory became corrupted before everything could be compiled into one large Excel file. Now you&rsquo;re missing a few hundred line items, the end of the year is coming up, and Accounting is breathing down your neck."><script src=https://eddiecosma.com/js/feather.min.js></script><link href=https://eddiecosma.com/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://eddiecosma.com/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://eddiecosma.com/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css media="(prefers-color-scheme: dark)"></head><body><div class=content><header><div class=main><a href=https://eddiecosma.com/>eddie_cosma</a></div><nav><a href=/>blog</a>
<a href=/projects/>projects</a>
<a href=/about/>about</a>
<a href=/contact/>contact</a></nav></header><main><article><div class=title><h1 class=title>Using Excel to access RxNorm</h1><div class=meta>Posted on Jan 8, 2017</div></div><section class=body><h2 id=background>Background</h2><p>Let&rsquo;s say you work in an institutional pharmacy that performs a physical inventory every December. This year, you discover there&rsquo;s a large discrepancy between the value of your current medication stock compared to the value of last year&rsquo;s stock. Apparently, some of the data on the handheld computers you use to perform inventory became corrupted before everything could be compiled into one large Excel file. Now you&rsquo;re missing a few hundred line items, the end of the year is coming up, and Accounting is breathing down your neck. You don&rsquo;t know what to do because there&rsquo;s no real pattern to this missing drug data, but one thing you do still have is the Excel file from last year&rsquo;s inventory.</p><p>Maybe you could compare last year&rsquo;s data to this year&rsquo;s data and see what&rsquo;s missing. It&rsquo;s a great idea in theory, but you notice that the columns containing the names of the drug formulations have minor differences because of the way your wholesaler&rsquo;s listings changed over the course of the year. No amount of Excel wizardry is going to let you find the differences between the column items meaningfully, and there are thousands of line items, so comparing them by hand is out. You do find NDC numbers associated with each line item in both documents, but those aren&rsquo;t directly comparable either because of the frequency at which you switch between product manufacturers. Now what?</p><figure><img src=/img/2017_01_08-using_excel_to_access_rxnorm/inventory.png alt="Figure 1. Example of nonstandard drug naming with NDC numbers"><figcaption><p>Figure 1. Example of nonstandard drug naming with NDC numbers</p></figcaption></figure><h2 id=rxnorm-and-standard-drug-terminology>RxNorm and Standard Drug Terminology</h2><p>One of the problems with pharmaceuticals is that there are a plethora of ways to represent a drug or group of drugs semantically. The ambiguity between divalproex, divalproex ER, and divalproex DR constitutes a single example of the challenges that result from managing a medication inventory. In order to help make it easier to communicate exactly what drug or group of drugs is being referenced, the FDA created a database called <a href=https://www.nlm.nih.gov/research/umls/rxnorm/index.html>RxNorm</a>, which touts itself as being a normalized drug naming system. Each drug &ldquo;concept&rdquo; is stored in the database under a numerical RXCUI, or RxNorm concept unique identifier, and refers to a specific string of text used to identify a drug or drugs. Some examples of drug concepts include:</p><ul><li>&ldquo;Naproxen&rdquo;</li><li>&ldquo;Naproxen 250 MG&rdquo;</li><li>&ldquo;Naproxen Oral Tablet&rdquo;</li></ul><p>One of the core features of RxNorm is an API, or application program interface, which makes it easy to build software applications around the database. Looking at the <a href=https://mor.nlm.nih.gov/download/rxnav/RxNormAPIs.html>API documentation</a>, you notice that there&rsquo;s a function that can be used to <a href="https://mor.nlm.nih.gov/download/rxnav/RxNormAPIs.html#uLink=RxNorm_REST_findRxcuiById">convert NDC numbers into RXCUI values</a>. More on this later.</p><p>To build on the scenario above: you deduce that one way to compare the inventory list from last year to that from this year is to convert the NDC from every line item into a standardized drug name and then compare the results. This way, it doesn&rsquo;t matter if the NDC numbers of your inventory on-hand changed from year to year. It also doesn&rsquo;t matter that your wholesaler changed their drug nomenclature because you can now ignore it altogether.</p><h2 id=converting-an-ndc-to-an-rxcui>Converting an NDC to an RXCUI</h2><p>Using the <a href="https://mor.nlm.nih.gov/download/rxnav/RxNormAPIs.html#uLink=RxNorm_REST_findRxcuiById"><code>rxcui</code></a> resource from the RxNorm API, you can convert an NDC number to an RXCUI. This resource is located at <code>https://rxnav.nlm.nih.gov/REST/rxcui</code> and takes a number of arguments. Using <code>?idtype=NDC</code> specifies that you want to pass an NDC number to <code>?id=</code>. Mercifully, the API will accept any 10- or 11-digit NDC number, so you do not have to convert your NDC numbers between formats (do note that 10-digit numbers must include dashes; for more information, see my article on <a href=/posts/converting-between-10-and-11-digit-ndcs/>NDC conversion</a>. Let&rsquo;s use the NDC 0781–1506–10 as an example. Putting this all together gives us the following address:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>https://rxnav.nlm.nih.gov/REST/rxcui?idtype=NDC&amp;id=0781-1506-10
</span></span></code></pre></div><p>If you open that location in a web browser, you&rsquo;re greeted with an XML file containing an RXCUI (as <code>&lt;rxnormId></code>) for our example NDC:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;yes&#34; ?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;rxnormdata&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;idGroup&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;idType&gt;</span>NDC<span style=color:#f92672>&lt;/idType&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;id&gt;</span>0781-1506-10<span style=color:#f92672>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;rxnormId&gt;</span>197381<span style=color:#f92672>&lt;/rxnormId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/idGroup&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/rxnormdata&gt;</span>
</span></span></code></pre></div><h2 id=converting-between-rxnorm-term-types>Converting Between RxNorm Term Types</h2><p>At this point, it&rsquo;s worth taking a moment to mention that RxNorm uses <a href=https://www.nlm.nih.gov/research/umls/rxnorm/docs/2015/appendix5.html>term types</a> (TTYs) to describe the level of complexity included in an RXCUI term, and there are different RXCUIs that may apply to a single product depending on the desired level of specificity. For example, a fluoxetine capsule may be linked to an RxNorm concept of &ldquo;fluoxetine&rdquo; (TTY = IN [&ldquo;ingredient&rdquo;]) at the same time it is linked to an RxNorm concept of &ldquo;fluoxetine oral product&rdquo; (TTY = SCDG [&ldquo;semantic clinical dose form group&rdquo;]). Different RXCUIs with different term types that all refer to a single product are linked with a complex relationship model that&rsquo;s built in to the RxNorm database. Using the <code>rxcui</code> API resource to look up an RXCUI can be unpredictable because it assumes a TTY. For this reason, it may be necessary to convert between term types if you&rsquo;re performing comparison operations like in our hypothetical scenario.</p><p>In order to convert between term types, we can again use the <a href="https://mor.nlm.nih.gov/download/rxnav/RxNormAPIs.html#uLink=RxNorm_REST_getRelatedByType"><code>rxcui</code></a> API resource with the following URL structure:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>https://rxnav.nlm.nih.gov/REST/rxcui/{RXCUI}/related?tty={TTY Code}
</span></span></code></pre></div><p>For the purpose of our example, we want to use the SCD (&ldquo;semantic clinical drug&rdquo;) TTY. Inserting our previous RXCUI and the TTY code into the URL gives us:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>https://rxnav.nlm.nih.gov/REST/rxcui/197381/related?tty=SCD
</span></span></code></pre></div><p>Again, visiting this address yields an XML file with a new RXCUI (as <code>&lt;rxnormId></code>) and the coveted standardized terminology string (as <code>&lt;name></code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;rxnormdata&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;relatedGroup&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;rxcui&gt;</span>197381<span style=color:#f92672>&lt;/rxcui&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;termType&gt;</span>SCD<span style=color:#f92672>&lt;/termType&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;conceptGroup&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;tty&gt;</span>SCD<span style=color:#f92672>&lt;/tty&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;conceptProperties&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;rxcui&gt;</span>197381<span style=color:#f92672>&lt;/rxcui&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;name&gt;</span>Atenolol 50 MG Oral Tablet<span style=color:#f92672>&lt;/name&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;synonym/&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;tty&gt;</span>SCD<span style=color:#f92672>&lt;/tty&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;language&gt;</span>ENG<span style=color:#f92672>&lt;/language&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;suppress&gt;</span>N<span style=color:#f92672>&lt;/suppress&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;umlscui&gt;</span>C0687940<span style=color:#f92672>&lt;/umlscui&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/conceptProperties&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/conceptGroup&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/relatedGroup&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/rxnormdata&gt;</span>
</span></span></code></pre></div><h2 id=accessing-rxnorm-with-excel>Accessing RxNorm with Excel</h2><p>So this is all well and good, but what we really want is to take these XML files, parse the important data, and enter them into an Excel spreadsheet. Doing this manually, or even programmatically, could take a considerable amount of time. Luckily, the newer versions of Excel has a few functions that can automatically access the XML files corresponding to each of our RxNorm queries and parse them. Note that this will only work in Excel 2013 or later for Windows (i.e., this will not work on macOS).</p><p>The first important function is <code>WEBSERVICE(url)</code>, which accepts a single URL parameter as a string and returns the contents of the file located at that URL. An NDC in cell A1 can be passed to RxNorm with the formula:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>=WEBSERVICE(&#34;https://rxnav.nlm.nih.gov/REST/rxcui?idtype=NDC&amp;id=&#34; &amp; A1)
</span></span></code></pre></div><p>The problem is that this would insert the entire contents of the XML file into your Excel file. The <code>=FILTERXML(xml, xpath)</code> function can be used to further whittle down the data to a usable RXCUI. The previous <code>WEBSERVICE</code> function can be passed as the <code>xml</code> parameter, and the path of the <code>&lt;rxnormId></code> tag in the file can be passed as an XPath string (More information on XPath can be found on the <a href=http://www.w3schools.com/xml/xpath_intro.asp>W3Schools website</a>). This ends up looking like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>=FILTERXML(WEBSERVICE(&#34;https://rxnav.nlm.nih.gov/REST/rxcui?idtype=NDC&amp;id=&#34; &amp; A1),
</span></span><span style=display:flex><span>	&#34;//rxnormID&#34;)
</span></span></code></pre></div><p>Following our scenario above, the resulting numerical RXCUI can be stored in a helper column, B, in Excel. A third column could use the following function to return a normalized drug name:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>=FILTERXML(WEBSERVICE(&#34;https://rxnav.nlm.nih.gov/REST/rxcui/&#34;
</span></span><span style=display:flex><span>	&amp; B1 &amp; &#34;/related?tty=SCD&#34;), &#34;//name[1]&#34;)
</span></span></code></pre></div><figure><img src=/img/2017_01_08-using_excel_to_access_rxnorm/inventory_standardized.png alt="Figure 2. Example of standardized drug naming"><figcaption><p>Figure 2. Example of standardized drug naming</p></figcaption></figure><p>At this point, we have the data we need to compare last year&rsquo;s inventory to this year&rsquo;s, which can be done trivially. Don&rsquo;t forget that you can extend these formulas down a dataset by double clicking the green box on the bottom-right corner of a selected cell. Do note that when doing this with thousands of rows of data, each row requires a separate set of web queries and so Excel can take some time to populate the cells. You must be patient. I believe that Excel will exceed the <a href=https://mor.nlm.nih.gov/download/rxnav/TermOfService.html>RxNorm maximum of 20 requests per second</a>, but when using a dataset of around 2,000 rows, I did not run into any problems. Be conscious and try to limit the number of times you perform large queries on the database.</p><h2 id=conclusion>Conclusion</h2><p>RxNorm is a powerful tool that can be integrated into Excel-based solutions for a wide variety of problems that occur in a typical pharmacy. The examples shown here of RxNorm functionality really just scratch the surface. I encourage you to explore the rest of the API on the <a href=https://mor.nlm.nih.gov/download/rxnav/TermOfService.html>RxNorm website</a> and consider what other problems you can use it to solve by combining it with the data-handling capabilities and ease-of-use of Excel.</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/rxnorm>RxNorm</a></li><li><a href=/tags/excel>Excel</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/eddie-cosma rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://www.linkedin.com/in/edwardcosma rel=me title=LinkedIn><i data-feather=linkedin></i></a>
<a class=border></a><a class=soc href=https://www.instagram.com/eddie_cosma/ rel=me title=Instagram><i data-feather=instagram></i></a>
<a class=border></a></div><div class=footer-info>2024 © Eddie Cosma | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>